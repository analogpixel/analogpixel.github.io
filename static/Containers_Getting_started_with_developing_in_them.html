<!DOCTYPE html>
<html>
<head>
	<title>Containers</title>
	<link rel="stylesheet" type="text/css" href="../css/style.css">
	<link href="https://fonts.googleapis.com/css?family=Anton|Baloo+Tamma|Lato|Arimo" rel="stylesheet">

  	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

  	<script src="../js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/font-awesome.min.css">
    
</head>
<body>
  <div style="background-color:white; width: 850px; margin-top: -20px; margin-left:auto; margin-right:auto; border-right: 2px solid rgba(85, 98, 109, 0.1);">

	<center><div class=headerLarge>Containers</div>
       	    <div class=headerSmall>Getting started with developing in them</div>
       	    <div class=headerDate>9/1/2017</div>
    </center>
    <br>
    <div class=blogContent><p>When getting started building containerized application the one thing I couldn&#39;t seem to find was how to develop a small application and easily test the application in a running container.  </p>
<p>What this boils down to is, I want my code out in a place I can edit it, but I want to run it within the confines of the container to make sure all the dependencies are correct, and I don&#39;t want to have to run a docker build every time I want to test my code, nor do I want to work within the docker container.</p>
<p>To do this you just need to be running docker on your machine, and then mount a volume from your docker server machine, to the docker container.  Since I&#39;m using flask, I can set the debug option and have the application reload every time I save in my editor.</p>
<h1 id="pre-work">Pre-Work</h1>
<p>Before you get started, let us create a simple docker file that will build an image we can work in</p>
<p>create the file Dockerfile with contents:</p>
<pre><code class="lang-dockerfile">from ubuntu:latest
run apt-get update
</code></pre>
<p>Then build the file using: <strong>docker build --rm -t testimage .</strong></p>
<p>For the rest of the post, the docker host, is the machine that is running docker, and the container is the container we just built (testimage).</p>
<h1 id="starting-the-image">Starting the Image</h1>
<ul>
<li>on your docker host, checkout your application you are working on.  for this example check it out to /home/username/app</li>
<li>next run: docker --rm -it -name testing -v /home/username/app:/app -p hostport:containerport testimage bash<ul>
<li>-it runs the container in interactive mode</li>
<li>-v mounts the directory /home/username/app from your docker server to the directory /app on the container (note the colon)</li>
<li>-p hostport:containerport  will map the port hostport from your docker server to the container port. If your container was running the web application on port 80, and you wanted it exposed on your server on 8080, the command would be -p 8080:80. SFor some reason this -p option and the order of host to container seems to be one of the hardest things to find on the Internet.</li>
<li>--rm clean up the image when we are done running it.</li>
<li>imagename is the name of the image you want to run, you can just say centos here and docker will pull down the centos image and you can use that.</li>
<li>the bash at the end tells docker to start up the container you specified, and then run bash; this will allow you to poke around the container to make sure all your files are were you would expect them.</li>
</ul>
</li>
</ul>
<p>Now that you have that running, you can then just open the source code you are working in on the docker host machine.  If you are using something like flask with the debug option turned on, then every time you save changes to the code, the application will reload in the container, and you can instantly view your changes on the port you exposed out of the container.</p>
<h1 id="using-docker-as-a-runtime-environment">Using docker as a runtime environment</h1>
<p>tools like conda allow you to have python separate python environments so you don&#39;t end up clobbering things when you install new modules.  But with docker you can have a complete anything environment, with all the correct tools needed to run certain binaries.  Depending on your OS, you can write a simple wrapper script that will run any local script/binary within a docker container that contains all the correct dependencies needed to run that app.</p>
<p>Let&#39;s start off by creating a simple container that will allow you to pipe input into it, and then have the input all converted to uppercase.  To start create the program test.py</p>
<pre><code class="lang-python">#!/usr/bin/python

import fileinput

for line in fileinput.input():
    print(line.upper())
</code></pre>
<p>Now create a Dockerfile:</p>
<pre><code class="lang-docker">from ubuntu:latest
run apt-get update
run apt-get install -y python
copy test.py /test.py
WORKDIR /
ENTRYPOINT [&quot;python&quot;]
CMD [&quot;test.py&quot;]
</code></pre>
<p>and then run the docker build command:</p>
<pre><code class="lang-sh">docker build -t test .
</code></pre>
<p>Now you can run a command and pipe it through the container:</p>
<pre><code class="lang-sh">cat test.py | docker run -i --rm --name test test
</code></pre>
<p>And with that you should see the source of the test.py program completely capitalized.</p>
<h1 id="conclusion">Conclusion</h1>
<p>The best way to figure out all this docker stuff (or anything) is to just use docker every day for small projects;  the more you use it, the more it starts to make sense (little by little.)  </p>
</div>
</div>
  
  <div class="blackBar">
    <a href="https://stuffonaskull.tumblr.com/"><img width=25 height=25 border=0 src=http://www.analogpixel.org/skull.png></a>
    <a href="http://analog.smugmug.com/"><i class="fa fa-camera-retro fa-2x" aria-hidden="true"></i></a> 
    <a href="https://github.com/analogpixel/"><i class="fa fa-github-alt fa-2x" aria-hidden="true"></i></a> 
    <a href="https://365drawingsonthewall.tumblr.com/"><i class="fa fa-pencil fa-2x" aria-hidden="true"></i></a> 
    <a href="http://analogpixel.org/html/recipes/food.html"><i class="fa fa-cutlery fa-2x" aria-hidden="true"></i></a> 
    <a href="mailto:matt.poepping@gmail.com"><i class="fa fa-envelope-o fa-2x" aria-hidden="true"></i></a> 
    <a href="http://analogpixel.org/"><i class="fa fa-home fa-2x" aria-hidden="true"></i></a>
  </div>

</body>
</html>